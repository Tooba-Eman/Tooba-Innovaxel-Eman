<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Modern URL Shortener</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">

  <div class="max-w-4xl mx-auto py-10 px-6">
    <h1 class="text-4xl font-bold text-center mb-10 text-indigo-400">ðŸ”— Modern URL Shortener</h1>

    <!-- Form Card -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- Create -->
      <section class="bg-gray-800 p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-4">Create Short URL</h2>
        <form id="createForm" class="space-y-4">
          <input type="text" id="createUrl" placeholder="Enter long URL"
                 class="w-full p-2 rounded bg-gray-700 text-white" required>
          <button type="submit"
                  class="bg-indigo-500 hover:bg-indigo-600 px-4 py-2 rounded w-full">
            Shorten
          </button>
        </form>
        <div id="createResponse" class="mt-2 text-sm text-green-300"></div>
        <div id="shortUrlBox" class="mt-3 hidden">
          <input type="text" id="shortUrlInput" readonly
                 class="w-full p-2 rounded bg-gray-700 text-white mb-2">
          <button onclick="copyToClipboard()"
                  class="bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded">
            Copy
          </button>
        </div>
      </section>

      <!-- Retrieve -->
      <section class="bg-gray-800 p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-4">Retrieve Original URL</h2>
        <form id="retrieveForm" class="space-y-4">
          <input type="text" id="retrieveCode" placeholder="Enter short code"
                 class="w-full p-2 rounded bg-gray-700 text-white" required>
          <button type="submit"
                  class="bg-indigo-500 hover:bg-indigo-600 px-4 py-2 rounded w-full">
            Retrieve
          </button>
        </form>
        <div id="retrieveResponse" class="mt-2 text-sm text-green-300"></div>
      </section>

      <!-- Update -->
      <section class="bg-gray-800 p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-4">Update URL</h2>
        <form id="updateForm" class="space-y-4">
          <input type="text" id="updateCode" placeholder="Short code"
                 class="w-full p-2 rounded bg-gray-700 text-white" required>
          <input type="text" id="newUrl" placeholder="New long URL"
                 class="w-full p-2 rounded bg-gray-700 text-white" required>
          <button type="submit"
                  class="bg-indigo-500 hover:bg-indigo-600 px-4 py-2 rounded w-full">
            Update
          </button>
        </form>
        <div id="updateResponse" class="mt-2 text-sm text-green-300"></div>
      </section>

      <!-- Delete -->
      <section class="bg-gray-800 p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-4">Delete Short URL</h2>
        <form id="deleteForm" class="space-y-4">
          <input type="text" id="deleteCode" placeholder="Short code"
                 class="w-full p-2 rounded bg-gray-700 text-white" required>
          <button type="submit"
                  class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded w-full">
            Delete
          </button>
        </form>
        <div id="deleteResponse" class="mt-2 text-sm text-red-300"></div>
      </section>

      <!-- Stats -->
      <section class="bg-gray-800 p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-4">URL Stats</h2>
        <form id="statsForm" class="space-y-4">
          <input type="text" id="statsCode" placeholder="Short code"
                 class="w-full p-2 rounded bg-gray-700 text-white" required>
          <button type="submit"
                  class="bg-indigo-500 hover:bg-indigo-600 px-4 py-2 rounded w-full">
            Get Stats
          </button>
        </form>
        <div id="statsResponse" class="mt-2 text-sm text-yellow-300"></div>
      </section>

      <!-- Redirect -->
      <section class="bg-gray-800 p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-4">Test Redirect</h2>
        <form id="redirectForm" class="space-y-4">
          <input type="text" id="redirectCode" placeholder="Short code"
                 class="w-full p-2 rounded bg-gray-700 text-white" required>
          <button type="submit"
                  class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded w-full">
            Go
          </button>
        </form>
      </section>

    </div>
  </div>

  <script>
    // Copy to clipboard
    function copyToClipboard() {
      const input = document.getElementById("shortUrlInput");
      input.select();
      input.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(input.value)
        .then(() => alert("Copied to clipboard!"))
        .catch(() => alert("Failed to copy"));
    }

    // Redirect
    document.getElementById("redirectForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const code = document.getElementById("redirectCode").value;
      window.location.href = `/r/${code}`;
    });

    // Create
    document.getElementById("createForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const url = document.getElementById("createUrl").value;
      const res = await fetch('/shorten', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url })
      });
      const data = await res.json();
      document.getElementById("createResponse").innerText = JSON.stringify(data, null, 2);
      if (data.success && data.data && data.data.short_url) {
        document.getElementById("shortUrlInput").value = data.data.short_url;
        document.getElementById("shortUrlBox").classList.remove("hidden");
      }
    });

    // Retrieve
    document.getElementById("retrieveForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const code = document.getElementById("retrieveCode").value;
      const res = await fetch(`/shorten/${code}`);
      const data = await res.json();
      document.getElementById("retrieveResponse").innerText = JSON.stringify(data, null, 2);
    });

    // Update
    document.getElementById("updateForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const code = document.getElementById("updateCode").value;
      const newUrl = document.getElementById("newUrl").value;
      const res = await fetch(`/shorten/${code}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url: newUrl })
      });
      const data = await res.json();
      document.getElementById("updateResponse").innerText = JSON.stringify(data, null, 2);
    });

    // Delete
    document.getElementById("deleteForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const code = document.getElementById("deleteCode").value;
      const res = await fetch(`/shorten/${code}`, { method: 'DELETE' });
      document.getElementById("deleteResponse").innerText =
        res.status === 204 ? "Deleted successfully!" : "Not found!";
    });

    // Stats
    document.getElementById("statsForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const code = document.getElementById("statsCode").value;
      const res = await fetch(`/shorten/${code}/stats`);
      const data = await res.json();
      document.getElementById("statsResponse").innerText = JSON.stringify(data, null, 2);
    });
  </script>
</body>
</html>
